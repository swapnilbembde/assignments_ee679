from scipy import signal
from scipy.io.wavfile import read, write
import numpy as np
import matplotlib.pyplot as plt
from math import pi
import sys

# select the segment  
if sys.argv[1] == 'a':
	# for p = 20

    #a = np.asarray([1.0, 0.236005432799, -0.644092002133, 0.0819119339449, \
    #-0.2124261564, -0.152211140765, -0.0212219709262, -0.13630085139,\ 
    #-0.0830381940115, -0.0594591290005, 0.0932528522119, -0.138673810679,\
    # -0.0449949546443, 0.160272165261, 0.107773913053, 0.0937237624822,\
    # -0.106615993903, -0.0430479902438, 0.00944250408534, -0.00745641174071,\
    #0.0831723106828])

    # for p = 10
    a = np.asarray([1.0, 0.229278962837, -0.645647130149, 0.0916355495711,\
     -0.207582361967, -0.173742441768, -0.00159815647695, -0.129920337525, \
     -0.0646863732807, -0.00292087909058, 0.0709251746617])

    b = np.asarray([ 3.01612624, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,\
     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ])
    SampFre = 8000.0

elif sys.argv[1] == 'n':
    a = np.asarray([1.0, -0.0343093242382, -0.926868858417, 0.0165509083365,\
     -0.00386836371951, 0.218989739824, -0.00834526166107, -0.204479256656, \
    	0.0612608771718, -0.00301307871679, 0.00852860873086, -0.000786003244963,\
    	 -0.0541912219039, 0.228276713792, -0.00981429198171, -0.185870867754,\
    	 0.00445150087087, -0.0142551645715, -0.130314042554, 0.00322505195405, \
    	 0.161683923034])

    b = np.asarray([2.24130211, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,\
     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ])
    SampFre = 8000.0

elif sys.argv[1] == 'i':
    a = np.asarray([1.0, 0.244453564833, -1.01664129699, -0.321295111969,\
     0.088749127459, 0.109822570243, 0.0952082699624, 0.207489730971,\
     -0.0215834114004, -0.281867271388, -0.0938234280706, 0.0639360961099,\
      0.0961474114684, 0.207959826937, 0.0511832367678, -0.242036238679,\
      -0.155966156495, 0.139158197106, 0.195869516629, -0.0979195745779,\
       -0.170353127148 ])

    b = np.asarray([ 2.55634885 , 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,\
     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ])
    SampFre = 8000.0

elif sys.argv[1] == 's':
	#for s p = 40
    a = np.asarray([1.0, -0.00358528757999, 0.385091318531, -0.11943297762,\
     -0.35715722615, -0.166353261538, -0.108766425583, -0.00221571686568,\
     0.0225611469574, -0.244560616563, 0.0622123574262, -0.101027641575,\
      0.0414860380115, -0.0309243387031, -0.00804769088502, -0.0591783440907,\
      -0.00655702747194, -0.0946193074253, 0.0152480326206, -0.0625141681721,\
       0.0254888396516, -0.0952285418858, -0.0607358904417, -0.113405325762,\
       0.0482700542505, -0.0185480613643, 0.0690345230921, -0.0596909779859,\
        0.0340837640503, -0.0993764375533, -0.0184148072237, -0.0289216749101,\
        -0.0919745287535, -0.0727036376883, -0.0187708573377, 0.0352487253815,\
         0.135518645672, 0.0874812212111, 0.108809324213, 0.0222556074524,\
         -0.0287374167142])

    b = np.asarray([4.66706473, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,\
     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,\
     0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,\
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0])
    SampFre = 16000.0

pitchperiod = 8000.0/60.0
duration = 300.0/1000.0
timepoints = np.linspace(0, duration, duration*SampFre, endpoint=False)

#input generation
if sys.argv[1] == 's':
	# random generator
    inp = np.random.normal(0, 1, duration*SampFre)
else:
	# impulse train
    inp = (1+signal.square(2 * np.pi * pitchperiod * timepoints, duty=0.01))/2

output = signal.lfilter(b, a, inp)
# De emphasis
doutput = signal.lfilter(np.asarray([1.0, 0.0]), np.asarray([1.0000, -0.9500]), output)

#plt.plot(timePoints, doutput)
#plt.show()

#write(sys.argv[1] + '10', SampFre, np.int16(doutput/np.max(np.abs(doutput)) * 32767))